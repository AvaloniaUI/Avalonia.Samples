<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.26">
<link rel="icon" type="image/svg" href="../../../../_docs/_Assets/Logo.svg">
<title>Snowflakes control sample</title>
<style>
@import url(https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css);

:root {
    --background: #fff;
    --black-color: #000;
    --background-yellow: #ff0;
    --border: #c0c0c0;
    --gray-color: #6c818f;
    --link-color-default: var(--accent-primary-color);
    --foreground-color: #222222;
    --accent-primary-color: #3578e5;
    --accent-secondary-color: #102445;
    --border2: #dddddd;
    --block-quote-color: #748590;
    --pre-background-color: #f2f2f2;
    --dark-gray-color: #333333;
    --kdb-background-color: #F7F7F7;
    --header-color: var(--accent-primary-color);
    --link-hover-color: #102445;
    --toc-border-color: #d9d9d9;
    --exampleblock-border-color: #e6e6e6;
    --em-color: #373737;
    --admotion-background-color: #e6e6e6;
    --sidebar-background-color: #e8ecef;
    --border-radius-default: 6px;
}

/* normalize.css v2.1.1 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary {
    display: block;
}

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video {
    display: inline-block;
}

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) {
    display: none;
    height: 0;
}

/** Address styling not present in IE 8/9. */
[hidden] {
    display: none;
}

/* ========================================================================== Base ========================================================================== */
/** 1. Prevent system color scheme's background color being used in Firefox, IE, and Opera. 2. Prevent system color scheme's text color being used in Firefox, IE, and Opera. 3. Set default font family to sans-serif. 4. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html {
    background: var(--background); /* 1 */
    color: var(--black-color); /* 2 */
    font-family: sans-serif; /* 3 */
    -ms-text-size-adjust: 100%; /* 4 */
    -webkit-text-size-adjust: 100%; /* 4 */
}

/** Remove default margin. */
body {
    margin: 0;
}

/* ========================================================================== Links ========================================================================== */
/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus {
    outline: thin dotted;
}

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover {
    outline: 0;
}

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] {
    border-bottom: 1px dotted;
}

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong {
    font-weight: bold;
}

/** Address styling not present in Safari 5 and Chrome. */
dfn {
    font-style: italic;
}

/** Address differences between Firefox and other browsers. */
hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/** Address styling not present in IE 8/9. */
mark {
    background: var(--background-yellow);
    color: var(--black-color);
}

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp {
    font-family: monospace, serif;
    font-size: 1em;
}

/** Improve readability of pre-formatted text in all browsers. */
pre {
    white-space: pre-wrap;
}

/** Set consistent quote types. */
q {
    quotes: "\201C" "\201D" "\2018" "\2019";
}

/** Address inconsistent and variable font size in all browsers. */
small {
    font-size: 80%;
}

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img {
    border: 0;
}

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) {
    overflow: hidden;
}

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure {
    margin: 0;
}

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset {
    border: 1px solid var(--border);
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend {
    border: 0; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea {
    font-family: inherit; /* 1 */
    font-size: 100%; /* 2 */
    margin: 0; /* 3 */
}

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input {
    line-height: normal;
}

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select {
    text-transform: none;
}

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
}

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] {
    cursor: default;
}

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
}

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table {
    border-collapse: collapse;
    border-spacing: 0;
}

*, *:before, *:after {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box;
}

html, body {
    font-size: 100%;
}

body {
    background: white;
    color: var(--foreground-color);
    padding: 0;
    margin: 0;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    line-height: 1;
    position: relative;
    cursor: auto;
}

a:hover {
    cursor: pointer;
}

a:focus {
    outline: none;
}

img, object, embed {
    max-width: 100%;
    height: auto;
}

object, embed {
    height: 100%;
}

img {
    -ms-interpolation-mode: bicubic;
}

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object {
    max-width: none !important;
}

.left {
    float: left !important;
}

.right {
    float: right !important;
}

.text-left {
    text-align: left !important;
}

.text-right {
    text-align: right !important;
}

.text-center {
    text-align: center !important;
}

.text-justify {
    text-align: justify !important;
}

.hide {
    display: none;
}

.antialiased, body {
    -webkit-font-smoothing: antialiased;
}

img {
    display: inline-block;
    vertical-align: middle;
}

textarea {
    height: auto;
    min-height: 50px;
}

select {
    width: 100%;
}

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: 1.21875em;
    line-height: 1.6;
}

.subheader, #content #toctitle, .admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title, .tableblock > caption {
    line-height: 1.4;
    color: var(--accent-primary-color);
    font-weight: 300;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td {
    margin: 0;
    /*padding: 0;*/
    direction: ltr;
}

/* Default Link Styles */
a {
    color: var(--link-color-default);
    text-decoration: none;
    line-height: inherit;
}

a:hover, a:focus {
    color: var(--header-color);
}

a img {
    border: none;
}

/* Default paragraph styles */
p {
    font-family: inherit;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    text-rendering: optimizeLegibility;
}

p aside {
    font-size: 0.875em;
    line-height: 1.35;
    font-style: italic;
}

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
    font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif;
    font-weight: bold;
    font-style: normal;
    color: var(--accent-primary-color);
    text-rendering: optimizeLegibility;
    margin-top: 1em;
    margin-bottom: 0.5em;
    line-height: 1.2125em;
}

h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small {
    font-size: 60%;
    color: var(--accent-secondary-color);
    line-height: 0;
}

h1 {
    font-size: 2.125em;
}

h2 {
    font-size: 1.6875em;
}

h3, #toctitle, .sidebarblock > .content > .title {
    font-size: 1.375em;
}

h4 {
    font-size: 1.125em;
}

h5 {
    font-size: 1.125em;
}

h6 {
    font-size: 1em;
}

hr {
    border: solid var(--border2);
    border-width: 1px 0 0;
    clear: both;
    margin: 1.25em 0 1.1875em;
    height: 0;
}

/* Helpful Typography Defaults */
em, i {
    font-style: italic;
    line-height: inherit;
}

strong, b {
    font-weight: bold;
    line-height: inherit;
}

small {
    font-size: 60%;
    line-height: inherit;
}

code {
    font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    font-weight: normal;
    color: var(--link-color-default);
}

/* Lists */
ul, ol, dl {
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    list-style-position: outside;
    font-family: inherit;
}

ul, ol {
    margin-left: 0;
}

/* Unordered Lists */
ul li ul, ul li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
    font-size: 1em; /* Override nested font-size change */
}

ul.square li ul, ul.circle li ul, ul.disc li ul {
    list-style: inherit;
}

ul.square {
    list-style-type: square;
}

ul.circle {
    list-style-type: circle;
}

ul.disc {
    list-style-type: disc;
}

ul.no-bullet {
    list-style: none;
}

/* Ordered Lists */
ol li ul, ol li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
}

/* Definition Lists */
dl dt {
    margin-bottom: 0.3em;
    font-weight: bold;
}

dl dd {
    margin-bottom: 0.75em;
}

/* Abbreviations */
abbr, acronym {
    text-transform: uppercase;
    font-size: 90%;
    color: black;
    border-bottom: 1px dotted var(--border2);
    cursor: help;
}

abbr {
    text-transform: none;
}

/* Blockquotes */
blockquote {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid var(--border2);
}

blockquote cite {
    display: block;
    font-size: 0.8125em;
    color: var(--block-quote-color);
}

blockquote cite:before {
    content: "\2014 \0020";
}

blockquote cite a, blockquote cite a:visited {
    color: var(--block-quote-color);
}

blockquote, blockquote p {
    line-height: 1.5;
    color: var(--accent-secondary-color);
}

/* Microformats */
.vcard {
    display: inline-block;
    margin: 0 0 1.25em 0;
    border: 1px solid var(--border2);
    padding: 0.625em 0.75em;
}

.vcard li {
    margin: 0;
    display: block;
}

.vcard .fn {
    font-weight: bold;
    font-size: 0.9375em;
}

.vevent .summary {
    font-weight: bold;
}

.vevent abbr {
    cursor: auto;
    text-decoration: none;
    font-weight: bold;
    border: none;
    padding: 0 0.0625em;
}

@media only screen and (min-width: 768px) {
    h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 {
        line-height: 1.4;
    }

    h1 {
        font-size: 2.75em;
    }

    h2 {
        font-size: 2.3125em;
    }

    h3, #toctitle, .sidebarblock > .content > .title {
        font-size: 1.6875em;
    }

    h4 {
        font-size: 1.4375em;
    }
}

/* Print styles.  Inlined to avoid required HTTP connection: www.phpied.com/delay-loading-your-print-css/ Credit to Paul Irish and HTML5 Boilerplate (html5boilerplate.com)
*/
.print-only {
    display: none !important;
}

@media print {
    * {
        background: transparent !important;
        color: var(--black-color) !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a, a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    .ir a:after, a[href^="javascript:"]:after, a[href^="#"]:after {
        content: "";
    }

    pre, blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr, img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p, h2, h3, #toctitle, .sidebarblock > .content > .title {
        orphans: 3;
        widows: 3;
    }

    h2, h3, #toctitle, .sidebarblock > .content > .title {
        page-break-after: avoid;
    }

    .hide-on-print {
        display: none !important;
    }

    .print-only {
        display: block !important;
    }

    .hide-for-print {
        display: none !important;
    }

    .show-for-print {
        display: inherit !important;
    }
}

/* Tables */
table {
    background: white;
    margin-bottom: 1.25em;
    border: solid 0 var(--border2);
}

table thead, table tfoot {
    background: none;
    font-weight: bold;
}

table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: var(--foreground-color);
    text-align: left;
}

table tr th, table tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: var(--foreground-color);
}

table tr.even, table tr.alt, table tr:nth-of-type(even) {
    background: none;
}

table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td {
    display: table-cell;
    line-height: 1.5;
}

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after {
    content: " ";
    display: table;
}

.clearfix:after, .float-group:after {
    clear: both;
}

*:not(pre) > code {
    font-size: 0.95em;
    padding: 0;
    white-space: nowrap;
    background-color: var(--pre-background-color);
    border: 0 solid var(--border2);
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
    text-shadow: none;
}

pre, pre > code {
    line-height: 1.2;
    color: inherit;
    font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    font-weight: normal;
}

kbd.keyseq {
    color: var(--dark-gray-color);
}

kbd:not(.keyseq) {
    display: inline-block;
    color: black;
    font-size: 0.75em;
    line-height: 1.4;
    background-color: var(--kdb-background-color);
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 2px white inset;
    margin: -0.15em 0.15em 0 0.15em;
    padding: 0.2em 0.6em 0.2em 0.5em;
    vertical-align: middle;
    white-space: nowrap;
}

kbd kbd:first-child {
    margin-left: 0;
}

kbd kbd:last-child {
    margin-right: 0;
}

.menuseq, .menu {
    color: black;
}

p a > code:hover {
    color: var(--link-hover-color);
}

#header, #content, #footnotes, #footer {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    margin-bottom: 0;
    max-width: 62.5em;
    *zoom: 1;
    position: relative;
    padding-left: 0.9375em;
    padding-right: 0.9375em;
}

#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after {
    content: " ";
    display: table;
}

#header:after, #content:after, #footnotes:after, #footer:after {
    clear: both;
}

#header {
    margin-bottom: 2.5em;
}

#header > h1 {
    color: var(--header-color);
    font-weight: bold;
    border-bottom: 1px solid var(--border2);
    margin-bottom: -28px;
    padding-bottom: 32px;
}

#header span {
    color: var(--accent-secondary-color);
}

#header #revnumber {
    text-transform: capitalize;
}

#header br {
    display: none;
}

#header br + span {
    padding-left: 3px;
}

#header br + span:before {
    content: "\2013 \0020";
}

#header br + span.author {
    padding-left: 0;
}

#header br + span.author:before {
    content: ", ";
}

#toc {
    border-bottom: 1px solid var(--border2);
    padding-bottom: 1.25em;
}

#toc > ul {
    margin-left: 0.25em;
}

#toc ul.sectlevel0 > li > a {
    font-style: italic;
}

#toc ul.sectlevel0 ul.sectlevel1 {
    margin-left: 0;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}

#toc ul {
    list-style-type: none;
}

#toctitle {
    color: var(--accent-primary-color);
}

@media only screen and (min-width: 1280px) {
    body.toc2 {
        padding-left: 20em;
    }

    #toc.toc2 {
        position: fixed;
        width: 20em;
        left: 0;
        top: 0;
        border-right: 1px solid var(--border2);
        border-bottom: 0;
        z-index: 1000;
        padding: 44px 1em 1em;
        height: 100%;
        overflow: auto;
    }

    #toc.toc2 > ul {
        padding-left: 1em;
    }

    #toc.toc2 #toctitle {
        margin-top: 0;
    }

    #toc.toc2 > ul {
        font-size: .95em;
    }

    #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 1.25em;
    }

    #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: 0.5em;
        margin-bottom: 0.5em;
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em;
    }

    body.toc2.toc-right #toc.toc2 {
        border-right: 0;
        border-left: 1px solid var(--border2);
        left: auto;
        right: 0;
    }
}

#content #toc {
    border-style: solid;
    border-width: 1px;
    border-color: var(--toc-border-color);
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: var(--pre-background-color);
    border-width: 0;
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
}

#content #toc > :first-child {
    margin-top: 0;
}

#content #toc > :last-child {
    margin-bottom: 0;
}

#content #toc a {
    color: var(--gray-color);
    text-decoration: none;
}

#content #toctitle {
    font-weight: bold;
    font-family: ff-meta-web-pro-1, ff-meta-web-pro-2, Arial, "Helvetica Neue", sans-serif;
    font-size: 1em;
    padding-left: 0.125em;
}

#footer {
    max-width: 100%;
    background-color: black;
    padding: 1.25em;
}

#footer-text {
    color: white;
    line-height: 1.35;
}

.sect1 {
    padding-bottom: 1.25em;
}

.sect1 + .sect1 {
    border-top: 1px solid var(--border2);
}

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor {
    position: absolute;
    width: 1em;
    margin-left: -1em;
    display: block;
    text-decoration: none;
    visibility: hidden;
    text-align: center;
    font-weight: normal;
}

#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before {
    content: '\00A7';
    font-size: .85em;
    vertical-align: text-top;
    display: block;
    margin-top: 0.05em;
}

#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover {
    visibility: visible;
}

#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link {
    color: var(--accent-primary-color);
    text-decoration: none;
}

#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover {
    color: var(--link-hover-color);
}

.imageblock, .literalblock, .listingblock, .verseblock, .videoblock {
    margin-bottom: 1.25em;
}

.admonitionblock td.content > .title, .exampleblock > .title, .imageblock > .title, .videoblock > .title, .listingblock > .title, .literalblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, .sidebarblock > .title, .tableblock > .title, .verseblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title {
    text-align: left;
    font-weight: bold;
}

.tableblock > caption {
    text-align: left;
    font-weight: bold;
    white-space: nowrap;
    overflow: visible;
    max-width: 0;
}

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p {
    font-size: inherit;
}

.admonitionblock > table {
    border: 0;
    background: none;
    width: 100%;
}

.admonitionblock > table td.icon {
    text-align: center;
    width: 60px;
    padding: 0;
    font-size: 1.5em;
}

.admonitionblock > table td.icon img {
    max-width: none;
}

.admonitionblock > table td.icon .title {
    font-weight: bold;
    text-transform: uppercase;
}

.admonitionblock > table td.content {
    /*padding-left: 1.125em;*/
    /*padding-right: 1.25em;*/
    border-left: 1px solid var(--border2);
    color: var(--accent-secondary-color);
}

.admonitionblock > table td.content > :last-child > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content {
    border-style: solid;
    border-width: 1px;
    border-color: var(--exampleblock-border-color);
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: white;
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
}

.exampleblock > .content > :first-child {
    margin-top: 0;
}

.exampleblock > .content > :last-child {
    margin-bottom: 0;
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6, .exampleblock > .content p {
    color: var(--dark-gray-color);
}

.exampleblock > .content h1, .exampleblock > .content h2, .exampleblock > .content h3, .exampleblock > .content #toctitle, .sidebarblock.exampleblock > .content > .title, .exampleblock > .content h4, .exampleblock > .content h5, .exampleblock > .content h6 {
    line-height: 1;
    margin-bottom: 0.625em;
}

.exampleblock > .content h1.subheader, .exampleblock > .content h2.subheader, .exampleblock > .content h3.subheader, .exampleblock > .content .subheader#toctitle, .sidebarblock.exampleblock > .content > .subheader.title, .exampleblock > .content h4.subheader, .exampleblock > .content h5.subheader, .exampleblock > .content h6.subheader {
    line-height: 1.4;
}

.exampleblock.result > .content {
    -webkit-box-shadow: 0 1px 8px var(--toc-border-color);
    box-shadow: 0 1px 8px var(--toc-border-color);
}

.sidebarblock {
    border-style: solid;
    border-width: 1px;
    border-color: var(--toc-border-color);
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: var(--pre-background-color);
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
}

.sidebarblock > :first-child {
    margin-top: 0;
}

.sidebarblock > :last-child {
    margin-bottom: 0;
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6, .sidebarblock p {
    color: var(--dark-gray-color);
}

.sidebarblock h1, .sidebarblock h2, .sidebarblock h3, .sidebarblock #toctitle, .sidebarblock > .content > .title, .sidebarblock h4, .sidebarblock h5, .sidebarblock h6 {
    line-height: 1;
    margin-bottom: 0.625em;
}

.sidebarblock h1.subheader, .sidebarblock h2.subheader, .sidebarblock h3.subheader, .sidebarblock .subheader#toctitle, .sidebarblock > .content > .subheader.title, .sidebarblock h4.subheader, .sidebarblock h5.subheader, .sidebarblock h6.subheader {
    line-height: 1.4;
}

.sidebarblock > .content > .title {
    color: var(--gray-color);
    margin-top: 0;
    line-height: 1.5;
}

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child {
    margin-bottom: 0;
}

.literalblock > .content pre, .listingblock > .content pre {
    background: #eeeeee;
    border-width: 1px;
    border-style: solid;
    border-color: #cccccc;
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
    padding: 0.5em;
    word-wrap: break-word;
}

.literalblock > .content pre.nowrap, .listingblock > .content pre.nowrap {
    overflow-x: auto;
    white-space: pre;
    word-wrap: normal;
}

.literalblock > .content pre > code, .listingblock > .content pre > code {
    display: block;
}

@media only screen {
    .literalblock > .content pre, .listingblock > .content pre {
        font-size: 0.76em;
    }
}

@media only screen and (min-width: 768px) {
    .literalblock > .content pre, .listingblock > .content pre {
        font-size: 0.855em;
    }
}

@media only screen and (min-width: 1280px) {
    .literalblock > .content pre, .listingblock > .content pre {
        font-size: 0.95em;
    }
}

.listingblock > .content {
    position: relative;
}

.listingblock:hover code[class*=" language-"]:before {
    text-transform: uppercase;
    font-size: 0.9em;
    color: #999;
    position: absolute;
    top: 0.375em;
    right: 0.375em;
}

.listingblock:hover code.asciidoc:before {
    content: "asciidoc";
}

.listingblock:hover code.clojure:before {
    content: "clojure";
}

.listingblock:hover code.css:before {
    content: "css";
}

.listingblock:hover code.groovy:before {
    content: "groovy";
}

.listingblock:hover code.html:before {
    content: "html";
}

.listingblock:hover code.java:before {
    content: "java";
}

.listingblock:hover code.javascript:before {
    content: "javascript";
}

.listingblock:hover code.python:before {
    content: "python";
}

.listingblock:hover code.ruby:before {
    content: "ruby";
}

.listingblock:hover code.scss:before {
    content: "scss";
}

.listingblock:hover code.xml:before {
    content: "xml";
}

.listingblock:hover code.yaml:before {
    content: "yaml";
}

.listingblock.terminal pre .command:before {
    content: attr(data-prompt);
    padding-right: 0.5em;
    color: #999;
}

.listingblock.terminal pre .command:not([data-prompt]):before {
    content: '$';
}

table.pyhltable {
    border: 0;
    margin-bottom: 0;
}

table.pyhltable td {
    vertical-align: top;
    padding-top: 0;
    padding-bottom: 0;
}

table.pyhltable td.code {
    padding-left: .75em;
    padding-right: 0;
}

.highlight.pygments .lineno, table.pyhltable td:not(.code) {
    color: #999;
    padding-left: 0;
    padding-right: .5em;
    border-right: 1px solid var(--border2);
}

.highlight.pygments .lineno {
    display: inline-block;
    margin-right: .25em;
}

table.pyhltable .linenodiv {
    background-color: transparent !important;
    padding-right: 0 !important;
}

.quoteblock {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid var(--border2);
}

.quoteblock blockquote {
    margin: 0 0 1.25em 0;
    padding: 0 0 0.5625em 0;
    border: 0;
}

.quoteblock blockquote > .paragraph:last-child p {
    margin-bottom: 0;
}

.quoteblock .attribution {
    margin-top: -.25em;
    padding-bottom: 0.5625em;
    font-size: 0.8125em;
    color: var(--block-quote-color);
}

.quoteblock .attribution br {
    display: none;
}

.quoteblock .attribution cite {
    display: block;
    margin-bottom: 0.625em;
}

table thead th, table tfoot th {
    font-weight: bold;
}

table.tableblock.grid-all {
    border-collapse: separate;
    border-spacing: 1px;
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
    border-top: 0 solid var(--border2);
    border-bottom: 0 solid var(--border2);
}

table.tableblock.frame-topbot, table.tableblock.frame-none {
    border-left: 0;
    border-right: 0;
}

table.tableblock.frame-sides, table.tableblock.frame-none {
    border-top: 0;
    border-bottom: 0;
}

table.tableblock td .paragraph:last-child p, table.tableblock td > p:last-child {
    margin-bottom: 0;
}

th.tableblock.halign-left, td.tableblock.halign-left {
    text-align: left;
}

th.tableblock.halign-right, td.tableblock.halign-right {
    text-align: right;
}

th.tableblock.halign-center, td.tableblock.halign-center {
    text-align: center;
}

th.tableblock.valign-top, td.tableblock.valign-top {
    vertical-align: top;
}

th.tableblock.valign-bottom, td.tableblock.valign-bottom {
    vertical-align: bottom;
}

th.tableblock.valign-middle, td.tableblock.valign-middle {
    vertical-align: middle;
}

p.tableblock.header {
    color: var(--foreground-color);
    font-weight: bold;
}

td > div.verse {
    white-space: pre;
}

ol {
    margin-left: 0.25em;
}

ul li ol {
    margin-left: 0;
}

dl dd {
    margin-left: 1.125em;
}

dl dd:last-child, dl dd:last-child > :last-child {
    margin-bottom: 0;
}

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist {
    margin-bottom: 0.625em;
}

ul.unstyled, ol.unnumbered, ul.checklist, ul.none {
    list-style-type: none;
}

ul.unstyled, ol.unnumbered, ul.checklist {
    margin-left: 0.625em;
}

ul.checklist li > p:first-child > i[class^="icon-check"]:first-child, ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    margin-right: 0.25em;
}

ul.checklist li > p:first-child > input[type="checkbox"]:first-child {
    position: relative;
    top: 1px;
}

ul.inline {
    margin: 0 auto 0.625em auto;
    margin-left: -1.375em;
    margin-right: 0;
    padding: 0;
    list-style: none;
    overflow: hidden;
}

ul.inline > li {
    list-style: none;
    float: left;
    margin-left: 1.375em;
    display: block;
}

ul.inline > li > * {
    display: block;
}

.unstyled dl dt {
    font-weight: normal;
    font-style: normal;
}

ol.arabic {
    list-style-type: decimal;
}

ol.decimal {
    list-style-type: decimal-leading-zero;
}

ol.loweralpha {
    list-style-type: lower-alpha;
}

ol.upperalpha {
    list-style-type: upper-alpha;
}

ol.lowerroman {
    list-style-type: lower-roman;
}

ol.upperroman {
    list-style-type: upper-roman;
}

ol.lowergreek {
    list-style-type: lower-greek;
}

.hdlist > table, .colist > table {
    border: 0;
    background: none;
}

.hdlist > table > tbody > tr, .colist > table > tbody > tr {
    background: none;
}

td.hdlist1 {
    padding-right: .8em;
    font-weight: bold;
}

td.hdlist1, td.hdlist2 {
    vertical-align: top;
}

.literalblock + .colist, .listingblock + .colist {
    margin-top: -0.5em;
}

.colist > table tr > td:first-of-type {
    padding: 0 .8em;
    line-height: 1;
}

.colist > table tr > td:last-of-type {
    padding: 0.25em 0;
}

.qanda > ol > li > p > em:only-child {
    color: var(--em-color);
}

.thumb, .th {
    line-height: 0;
    display: inline-block;
    border: solid 4px white;
    -webkit-box-shadow: 0 0 0 1px var(--border2);
    box-shadow: 0 0 0 1px var(--border2);
}

.imageblock.left, .imageblock[style*="float: left"] {
    margin: 0.25em 0.625em 1.25em 0;
}

.imageblock.right, .imageblock[style*="float: right"] {
    margin: 0.25em 0 1.25em 0.625em;
}

.imageblock > .title {
    margin-bottom: 0;
}

.imageblock.thumb, .imageblock.th {
    border-width: var(--border-radius-default);
}

.imageblock.thumb > .title, .imageblock.th > .title {
    padding: 0 0.125em;
}

.image.left, .image.right {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
    display: inline-block;
    line-height: 0;
}

.image.left {
    margin-right: 0.625em;
}

.image.right {
    margin-left: 0.625em;
}

a.image {
    text-decoration: none;
}

span.footnote, span.footnoteref {
    vertical-align: super;
    font-size: 0.875em;
}

span.footnote a, span.footnoteref a {
    text-decoration: none;
}

#footnotes {
    padding-top: 0.75em;
    padding-bottom: 0.75em;
    margin-bottom: 0.625em;
}

#footnotes hr {
    width: 20%;
    min-width: 6.25em;
    margin: -.25em 0 .75em 0;
    border-width: 1px 0 0 0;
}

#footnotes .footnote {
    padding: 0 0.375em;
    line-height: 1.3;
    font-size: 0.875em;
    margin-left: 1.2em;
    text-indent: -1.2em;
    margin-bottom: .2em;
}

#footnotes .footnote a:first-of-type {
    font-weight: bold;
    text-decoration: none;
}

#footnotes .footnote:last-of-type {
    margin-bottom: 0;
}

#content #footnotes {
    margin-top: -0.625em;
    margin-bottom: 0;
    padding: 0.75em 0;
}

.gist .file-data > table {
    border: none;
    background: var(--background);
    width: 100%;
    margin-bottom: 0;
}

.gist .file-data > table td.line-data {
    width: 99%;
}

div.unbreakable {
    page-break-inside: avoid;
}

.big {
    font-size: larger;
}

.small {
    font-size: smaller;
}

.underline {
    text-decoration: underline;
}

.overline {
    text-decoration: overline;
}

.line-through {
    text-decoration: line-through;
}

.aqua {
    color: #00bfbf;
}

.aqua-background {
    background-color: #00fafa;
}

.black {
    color: black;
}

.black-background {
    background-color: black;
}

.blue {
    color: #0000bf;
}

.blue-background {
    background-color: #0000fa;
}

.fuchsia {
    color: #bf00bf;
}

.fuchsia-background {
    background-color: #fa00fa;
}

.gray {
    color: #606060;
}

.gray-background {
    background-color: #7d7d7d;
}

.green {
    color: #006000;
}

.green-background {
    background-color: #007d00;
}

.lime {
    color: #00bf00;
}

.lime-background {
    background-color: #00fa00;
}

.maroon {
    color: #600000;
}

.maroon-background {
    background-color: #7d0000;
}

.navy {
    color: #000060;
}

.navy-background {
    background-color: #00007d;
}

.olive {
    color: #606000;
}

.olive-background {
    background-color: #7d7d00;
}

.purple {
    color: #600060;
}

.purple-background {
    background-color: #7d007d;
}

.red {
    color: #bf0000;
}

.red-background {
    background-color: #fa0000;
}

.silver {
    color: #909090;
}

.silver-background {
    background-color: #bcbcbc;
}

.teal {
    color: #006060;
}

.teal-background {
    background-color: #007d7d;
}

.white {
    color: #bfbfbf;
}

.white-background {
    background-color: #fafafa;
}

.yellow {
    color: #bfbf00;
}

.yellow-background {
    background-color: #fafa00;
}

span.icon > [class^="icon-"], span.icon > [class*=" icon-"] {
    cursor: default;
}


.admonitionblock td.icon [class^="icon-"]:before {
    font-size: 2.5em;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    cursor: default;
}

.admonitionblock td.icon .icon-note:before {
    content: "\f05a";
    color: var(--accent-primary-color);
}

.admonitionblock td.icon .icon-tip:before {
    content: "\f0eb";
    /*text-shadow: 1px 1px 2px var(--accent-primary-color);*/
    color: var(--accent-primary-color);
}

.fa {
    font-family: "FontAwesome", "Helvetica Neue", sans-serif;
}

.admonitionblock td.icon .icon-warning:before {
    content: "\f071";
    color: #bf6900;
}

.admonitionblock td.icon .icon-caution:before {
    content: "\f06d";
    color: #bf3400;
}

.admonitionblock td.icon .icon-important:before {
    content: "\f06a";
    color: #bf0000;
}

.conum {
    display: inline-block;
    color: white !important;
    background-color: black;
    -webkit-border-radius: 100px;
    border-radius: 100px;
    text-align: center;
    width: 20px;
    height: 20px;
    font-size: 12px;
    font-weight: bold;
    line-height: 20px;
    font-family: Arial, sans-serif;
    font-style: normal;
    position: relative;
    top: -2px;
    letter-spacing: -1px;
}

.conum * {
    color: white !important;
}

.conum + b {
    display: none;
}

.conum:after {
    content: attr(data-value);
}

.conum:not([data-value]):empty {
    display: none;
}

h4 {
    color: var(--gray-color);
}

.literalblock > .content > pre, .listingblock > .content > pre {
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
    margin-left: 0.5em;
    margin-right: 0.5em;
}

.admonitionblock {
    margin-left: .5em;
    margin-right: .5em;
}

.admonitionblock > table {
    border: 1px solid var(--accent-primary-color);
    border-left-width: 4px;
    background-color: var(--admotion-background-color);
    border-collapse: separate;
    -webkit-border-radius: var(--border-radius-default);
    border-radius: var(--border-radius-default);
}

.admonitionblock > table td.icon {
    padding-top: .5em;
    padding-bottom: .5em;
}

.admonitionblock > table td.content {
    padding: .5em .2em;
    color: black;
    font-size: .9em;
    border-left: none;
}

.sidebarblock {
    background-color: var(--sidebar-background-color);
    border-color: #ccc;
}

.sidebarblock > .content > .title {
    color: var(--link-color-default);
}

table.tableblock.grid-all {
    border-collapse: collapse;
    -webkit-border-radius: 0;
    border-radius: 0;
}

table.tableblock.grid-all th.tableblock, table.tableblock.grid-all td.tableblock {
    border-bottom: 1px solid #aaa;
}

#footer {
    background-color: var(--accent-primary-color);
    padding: 2em;
}

#footer-text {
    color: #eee;
    font-size: 0.8em;
    text-align: center;
}
</style>
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .ges {
  font-weight: bold;
  font-style: italic;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Snowflakes control sample</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_before_we_start">Before we start</a>
<ul class="sectlevel2">
<li><a href="#_when_to_render_on_your_own">When to Render on your own</a></li>
<li><a href="#_defining_the_game_concept">Defining the game concept</a></li>
</ul>
</li>
<li><a href="#_the_solution">The Solution</a>
<ul class="sectlevel2">
<li><a href="#_step_1_prepare_the_snowflake_model">Step 1: Prepare the Snowflake-Model</a></li>
<li><a href="#_step_2_set_up_the_gameviewmodel">Step 2: Set up the GameViewModel</a></li>
<li><a href="#_step_3_add_the_snowflakescontrol">Step 3: Add the SnowflakesControl</a></li>
<li><a href="#_step_4_add_the_control_to_the_view">Step 4: Add the control to the view</a></li>
<li><a href="#_bonus_1_implement_a_custom_draw_operation">Bonus 1: Implement a custom draw operation</a></li>
<li><a href="#_bonus_2_adding_some_beauty_to_the_game">Bonus 2: Adding some beauty to the game</a></li>
<li><a href="#_see_it_in_action">See it in action</a></li>
</ul>
</li>
<li><a href="#_related">Related</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This example will show you how to create a custom control that overrides <code>OnRender</code> in order to have advanced render capabilities. It also shows how custom hit-testing can help to solve special tasks. We will create a simple game where the user should collect some snowflakes with their mouse pointer.</p>
</div>
<!-- toc disabled -->
<h3 id="_difficulty" class="discrete">Difficulty</h3>
<div class="paragraph">
<p>üêî Normal üêî</p>
</div>
<h3 id="_buzz_words" class="discrete">Buzz-Words</h3>
<div class="paragraph">
<p>Custom Control, Render, Hit-Testing, Custom Animations</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_we_start">Before we start</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this sample we assume that you are familiar with Avalonia, the <code>MVVM</code>-pattern and how to create custom <code>Controls</code>, as well as how to define <code>AvaloniaProperties</code>. If this is new to you, please start with other tutorials first:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="../../../../README.html#_mvvm_samples">[MVVM-Basics]</a></p>
</li>
<li>
<p><a href="../../CustomControls/RatingControlSample/README.html">[RatingControlSample]</a></p>
</li>
<li>
<p><a href="https://docs.avaloniaui.net/docs/guides/custom-controls/">[Avalonia-Documentation]</a></p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_when_to_render_on_your_own">When to Render on your own</h3>
<div class="paragraph">
<p>There may be some special cases where a <code>TemplatedControl</code>, <code>ContentControl</code> or similar base class is not well suited, for example:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you need to display complex geometry</p>
</li>
<li>
<p>If you have many objects to render which otherwise adds a huge layout-overhead</p>
</li>
<li>
<p>If you need to control each render step</p>
</li>
<li>
<p>if you want to use special things otherwise not available, such as <a href="https://learn.microsoft.com/en-us/dotnet/api/skiasharp?view=skiasharp-2.88">[custom SkiaSharp-drawings]</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_defining_the_game_concept">Defining the game concept</h3>
<div class="paragraph">
<p>Before we finally start to implement the game, we should make some considerations how our control should look like and how it should work. To shorten it, we use a plain list of notes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The game will have just one level</p>
</li>
<li>
<p>The game must not run infinite &#8594; We need a way to start and stop the game</p>
</li>
<li>
<p>The game must render several snowflakes (represented as circles)</p>
<div class="ulist">
<ul>
<li>
<p>Each snowflake should have a random start position</p>
</li>
<li>
<p>Each snowflake should be able to move with different speed</p>
</li>
<li>
<p>Snowflakes should be of different sizes</p>
</li>
</ul>
</div>
</li>
<li>
<p>The user should be able to collect some score</p>
<div class="ulist">
<ul>
<li>
<p>The user must be able to collect snowflakes with their mouse device</p>
</li>
<li>
<p>Nice to have: The user should be able to see their current score</p>
</li>
<li>
<p>Nice to have: Show a score indicator for each hit snowflake</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_solution">The Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We will create a custom control that will draw itself based on the data provided.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To show you how this control can be bound to a <code>ViewModel</code> we will use the <code>MVVM</code>-pattern for demonstration here, even if it is not really needed in our case.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_step_1_prepare_the_snowflake_model">Step 1: Prepare the Snowflake-Model</h3>
<div class="paragraph">
<p>In the folder <code>Models</code> we create a new file <code>Snowflake.cs</code> which will have the following properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Public properties of the snowflake class</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the horizontal position in relative unit (0 &#8230;&#8203; 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the vertical position in relative unit (0 &#8230;&#8203; 1)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Diameter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the diameter in pixel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Radius</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the radius in pixel</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Speed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the peed of the snowflake in 1/second (relative unit)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>As we want the control to be of any size and resizable, we store the position in relative units which we need to convert into the actual viewport on request.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In Avalonia you can use <code>Bounds</code> to get the Controls bounds, which we here call "viewport"
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To achieve this conversion we add method that takes a <code>Rect</code> as parameter and returns a <code>Point</code> positioned inside this rectangle.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="n">Point</span> <span class="nf">GetCenterForViewport</span><span class="p">(</span><span class="n">Rect</span> <span class="n">viewport</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="n">X</span> <span class="p">*</span> <span class="n">viewport</span><span class="p">.</span><span class="n">Width</span> <span class="p">+</span> <span class="n">viewport</span><span class="p">.</span><span class="n">Left</span><span class="p">,</span>
        <span class="n">Y</span> <span class="p">*</span> <span class="n">viewport</span><span class="p">.</span><span class="n">Height</span> <span class="p">+</span> <span class="n">viewport</span><span class="p">.</span><span class="n">Top</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that would be enough to render the snowflakes, but these should also be able to move. Since speed is in <code>1/second</code> we can use the elapsed time between two frames to calculate the new position.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="k">void</span> <span class="nf">Move</span><span class="p">(</span><span class="kt">double</span> <span class="n">elapsedMilliseconds</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Speed is in 1/sec so we have to convert it into 1/ms.</span>
    <span class="n">Y</span> <span class="p">+=</span> <span class="n">elapsedMilliseconds</span> <span class="p">*</span> <span class="n">Speed</span> <span class="p">/</span> <span class="m">1000.0</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Y</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Y</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we also want the snowflake to be hit-able, we need a way to test whether a certain point is inside or outside our bounds. As we represent the snowflake as circles, this is straight forward:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="kt">bool</span> <span class="nf">IsHit</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">,</span> <span class="n">Rect</span> <span class="n">viewport</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// since the snowflake is represented as a circle, we just can test</span>
    <span class="c1">// if the distance to the center is equal of smaller than the radius.</span>

    <span class="kt">var</span> <span class="n">distance</span> <span class="p">=</span> <span class="p">((</span><span class="n">Vector</span><span class="p">)(</span><span class="nf">GetCenterForViewport</span><span class="p">(</span><span class="n">viewport</span><span class="p">)</span> <span class="p">-</span> <span class="n">point</span><span class="p">)).</span><span class="n">Length</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">distance</span> <span class="p">&lt;=</span> <span class="n">Radius</span><span class="p">;</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Last but not least the hit-score can be calculated in the following way:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="kt">int</span> <span class="nf">GetHitScore</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// The smaller and the faster the snowflake, the higher the score.</span>
    <span class="k">return</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="m">1</span><span class="p">/</span><span class="n">Radius</span> <span class="p">*</span> <span class="m">200</span> <span class="p">+</span> <span class="n">Speed</span> <span class="p">/</span> <span class="m">10.0</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the final class <a href="Models/Snowflake.cs">Models/Snowflake.cs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_set_up_the_gameviewmodel">Step 2: Set up the GameViewModel</h3>
<div class="paragraph">
<p>The <code>ViewModel</code> will be responsible for creating and managing the snowflakes, tracking the game status and storing the users current score.</p>
</div>
<div class="paragraph">
<p>It has the following public properties:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. Public properties of the SnowflakeGameViewModel-class</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snowflakes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ObservableCollection&lt;Snowflake&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets a collection of available snowflakes.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GameDuration</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TimeSpan</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets the duration of the game. Also updates GameDurationMilliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GameDurationMilliseconds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets duration of the game in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MillisecondsRemaining</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets how many times is remaining in milliseconds.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsGameRunning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets if the game is currently running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets the current users score.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition, we need these two private fields:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. Private fields of the SnowflakeGameViewModel-class</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_gameTimer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DispatcherTimer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A readonly timer that ticks every 100 ms and updates the game status. Only active if the game is running.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_stopwatch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stopwatch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A readonly stopwatch to measure elapsed game time. Will be reset when the game ends.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>To start a new game we add a <a href="../../MVVM/CommandSample/README.html">[Command]</a> which will clear any previous snowflakes, add some new snowflakes with random parameters and start the game:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="p">[</span><span class="n">RelayCommand</span><span class="p">]</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">StartGame</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Clear all snowflakes.</span>
    <span class="n">Snowflakes</span><span class="p">.</span><span class="nf">Clear</span><span class="p">();</span>

    <span class="c1">// Reset game score.</span>
    <span class="n">Score</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>

    <span class="c1">// Add some snowflakes at random positions, having random diameters and speed.</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="m">200</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span>
    <span class="p">{</span>
        <span class="n">Snowflakes</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Snowflake</span><span class="p">(</span>
            <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">(),</span>
            <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">(),</span>
            <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">()</span> <span class="p">*</span> <span class="m">5</span> <span class="p">+</span> <span class="m">2</span><span class="p">,</span>
            <span class="n">Random</span><span class="p">.</span><span class="n">Shared</span><span class="p">.</span><span class="nf">NextDouble</span><span class="p">()</span> <span class="p">/</span> <span class="m">5</span> <span class="p">+</span> <span class="m">0.1</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="c1">// Set game time.</span>
    <span class="n">GameDuration</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="nf">FromMinutes</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>

    <span class="c1">// Indicate that game has started.</span>
    <span class="n">IsGameRunning</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>

    <span class="c1">// Start the timer and stopwatch.</span>
    <span class="n">_stopwatch</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
    <span class="n">_gameTimer</span><span class="p">.</span><span class="nf">Start</span><span class="p">();</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Finally, we need to update the game status whenever the game timer ticks. This is done in this handler:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">private</span> <span class="k">void</span> <span class="nf">OnGameTimerTick</span><span class="p">(</span><span class="kt">object</span><span class="p">?</span> <span class="n">sender</span><span class="p">,</span> <span class="n">EventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Update the remaining milliseconds left.</span>
    <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="k">nameof</span><span class="p">(</span><span class="n">MillisecondsRemaining</span><span class="p">));</span>

    <span class="c1">// If no more time is left, stop the timer and stopwatch and stop the game.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">MillisecondsRemaining</span> <span class="p">&lt;=</span> <span class="m">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_gameTimer</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">_stopwatch</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="n">IsGameRunning</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the final class: <a href="ViewModels/SnowflakeGameViewModel.cs">ViewModels/SnowflakeGameViewModel.cs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_add_the_snowflakescontrol">Step 3: Add the SnowflakesControl</h3>
<div class="paragraph">
<p>Now it&#8217;s time to add the needed <code>Control</code> to render our game. Therefore, we add a new folder <code>Controls</code> and inside we add a new class <code>SnowflakesControl.cs</code>. This class must inherit <code>Control</code>.</p>
</div>
<div class="paragraph">
<p>The control needs some <a href="https://docs.avaloniaui.net/docs/guides/custom-controls/how-to-create-advanced-custom-controls">[AvaloniaProperties]</a> to allow us to bind to it.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. Public bindable properties of the SnowflakesControl-class</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Property</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Snowflakes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IList&lt;Snowflake&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets a list of snowflakes to render. This is a direct property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IsRunning</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets if the game is running. This is a styled property.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Score</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets or sets the users score. This is a direct property.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>All the above properties should trigger a new render pass if they change. We can du this by adding the following line into the static constructor:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">static</span> <span class="nf">SnowflakesControl</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// Make sure Render is updated whenever one of these properties changes</span>
    <span class="n">AffectsRender</span><span class="p">&lt;</span><span class="n">SnowflakesControl</span><span class="p">&gt;(</span><span class="n">IsRunningProperty</span><span class="p">,</span> <span class="n">SnowflakesProperty</span><span class="p">,</span> <span class="n">ScoreProperty</span><span class="p">);</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>In addition, we have one private field as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. Private fields of the SnowflakesControl-class</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Field</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">_stopwatch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stopwatch</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A readonly stopwatch to measure elapsed between two render frames. Will be reset after each render frame.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The stopwatch will be started or stopped whenever <code>IsRunning</code> changed. We can do this by overriding <code>OnPropertyChanged</code> and filter for the property of interest accordingly:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="n">AvaloniaPropertyChangedEventArgs</span> <span class="n">change</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">base</span><span class="p">.</span><span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="n">change</span><span class="p">);</span>

    <span class="c1">// If IsRunning is updated, we need to start or stop the stopwatch accordingly.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">.</span><span class="n">Property</span> <span class="p">==</span> <span class="n">IsRunningProperty</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">change</span><span class="p">.</span><span class="n">GetNewValue</span><span class="p">&lt;</span><span class="kt">bool</span><span class="p">&gt;())</span>
        <span class="p">{</span>
            <span class="c1">// Resets and starts the stopwatch</span>
            <span class="n">_stopwatch</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">_stopwatch</span><span class="p">.</span><span class="nf">Stop</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This is all we need to start rendering. If you override <code>OnRender</code>, you will get a <code>DrawingContext</code> that has several methods available to render low-level geometry. So let&#8217;s do that and render our snowflakes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="cs"><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Render</span><span class="p">(</span><span class="n">DrawingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Figure out how much time elapsed since last render loop</span>
    <span class="kt">var</span> <span class="n">elapsedMilliseconds</span> <span class="p">=</span> <span class="n">_stopwatch</span><span class="p">.</span><span class="n">Elapsed</span><span class="p">.</span><span class="n">TotalMilliseconds</span><span class="p">;</span>

    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">snowFlake</span> <span class="k">in</span> <span class="n">Snowflakes</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// If the game is running, move each flake to it's updated position</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsRunning</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">snowFlake</span><span class="p">.</span><span class="nf">Move</span><span class="p">(</span><span class="n">elapsedMilliseconds</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Draw the snowflake (we use a simple circle here)</span>
        <span class="n">context</span><span class="p">.</span><span class="nf">DrawEllipse</span><span class="p">(</span>
            <span class="n">Brushes</span><span class="p">.</span><span class="n">White</span><span class="p">,</span>
            <span class="k">null</span><span class="p">,</span>
            <span class="n">snowFlake</span><span class="p">.</span><span class="nf">GetCenterForViewport</span><span class="p">(</span><span class="n">Bounds</span><span class="p">),</span>
            <span class="n">snowFlake</span><span class="p">.</span><span class="n">Radius</span><span class="p">,</span>
            <span class="n">snowFlake</span><span class="p">.</span><span class="n">Radius</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">base</span><span class="p">.</span><span class="nf">Render</span><span class="p">(</span><span class="n">context</span><span class="p">);</span>

    <span class="c1">// Request next frame as soon as possible, if the game is running. Remember to reset the stopwatch.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">IsRunning</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Dispatcher</span><span class="p">.</span><span class="n">UIThread</span><span class="p">.</span><span class="nf">Post</span><span class="p">(</span><span class="n">InvalidateVisual</span><span class="p">,</span> <span class="n">DispatcherPriority</span><span class="p">.</span><span class="n">Render</span><span class="p">);</span>
        <span class="n">_stopwatch</span><span class="p">.</span><span class="nf">Restart</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We use <code>Dispatcher.UIThread.Post</code> to request the next frame in order to give the UI-thread enough time to handle input etc. If we didn&#8217;t use the dispatcher, the app would freeze.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is how a single render frame would look like:</p>
</div>
<div class="paragraph">
<div class="title">Result of a single render loop</div>
<p><span class="image"><img src="_docs/single_render_frame.png" alt="single render frame"></span></p>
</div>
<div class="paragraph">
<p>As we want to check if our pointer is over any <code>Snowflake</code>, we will override the <code>OnPointerEntered</code> and <code>OnPointerMoved</code> methods. From the <code>PointerEventArgs</code> we can read the pointer position and forward it to a method that tests for hits,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="c1">/// &lt;inheritdoc /&gt;</span>
<span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPointerEntered</span><span class="p">(</span><span class="n">PointerEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">HitTestSnowFlakes</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">GetPosition</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">base</span><span class="p">.</span><span class="nf">OnPointerEntered</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// &lt;inheritdoc /&gt;</span>
<span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">OnPointerMoved</span><span class="p">(</span><span class="n">PointerEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nf">HitTestSnowFlakes</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="nf">GetPosition</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="k">base</span><span class="p">.</span><span class="nf">OnPointerMoved</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">/// &lt;summary&gt;</span>
<span class="c1">/// This method will check if the pointer has hit any snowflake. If so, it will remove the snowflake from the list</span>
<span class="c1">/// and update the score.</span>
<span class="c1">/// &lt;/summary&gt;</span>
<span class="c1">/// &lt;param name="point"&gt;the pointer point to test.&lt;/param&gt;</span>
<span class="k">private</span> <span class="k">void</span> <span class="nf">HitTestSnowFlakes</span><span class="p">(</span><span class="n">Point</span> <span class="n">point</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// if the game is not running, we don't need to do anything.</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">IsRunning</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>

    <span class="c1">// loop through all snowflakes and check if the pointer is inside one of them.</span>
    <span class="c1">// Copy the list to avoid concurrent modification exceptions.</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">snowFlake</span> <span class="k">in</span> <span class="n">Snowflakes</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">snowFlake</span><span class="p">.</span><span class="nf">IsHit</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">Bounds</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">Snowflakes</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="n">snowFlake</span><span class="p">);</span>
            <span class="n">Score</span> <span class="p">+=</span> <span class="n">snowFlake</span><span class="p">.</span><span class="nf">GetHitScore</span><span class="p">();</span>

            <span class="c1">// Add a text hint about the earned score. We also hand over the containing collection,</span>
            <span class="c1">// so it can auto-remove itself after 1 second.</span>
            <span class="n">_scoreHintsCollection</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ScoreHint</span><span class="p">(</span><span class="n">snowFlake</span><span class="p">,</span> <span class="n">_scoreHintsCollection</span><span class="p">));</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>What this method does is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the game is running, search for all snowflakes hit by the pointer</p>
<div class="ulist">
<ul>
<li>
<p>If any is found, remove it from the collection</p>
</li>
<li>
<p>If any is found, add the score to the total score</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Here is the final class <a href="Controls/SnowflakesControl.cs">Controls/SnowflakesControl.cs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_add_the_control_to_the_view">Step 4: Add the control to the view</h3>
<div class="paragraph">
<p>To use the control, just add it to any sample view.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Remember to add the needed xml-namespaces
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;UserControl</span> <span class="na">xmlns=</span><span class="s">"https://github.com/avaloniaui"</span>
             <span class="na">xmlns:x=</span><span class="s">"http://schemas.microsoft.com/winfx/2006/xaml"</span>
             <span class="na">xmlns:d=</span><span class="s">"http://schemas.microsoft.com/expression/blend/2008"</span>
             <span class="na">xmlns:mc=</span><span class="s">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
             <span class="na">xmlns:controls=</span><span class="s">"clr-namespace:SnowflakesControlSample.Controls"</span>
             <span class="na">xmlns:viewModels=</span><span class="s">"clr-namespace:SnowflakesControlSample.ViewModels"</span>
             <span class="na">mc:Ignorable=</span><span class="s">"d"</span>
             <span class="na">d:DesignWidth=</span><span class="s">"800"</span>
             <span class="na">d:DesignHeight=</span><span class="s">"450"</span>
             <span class="na">x:Class=</span><span class="s">"SnowflakesControlSample.Views.MainView"</span>
             <span class="na">x:DataType=</span><span class="s">"viewModels:SnowflakeGameViewModel"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;Design.DataContext&gt;</span>
        <span class="c">&lt;!-- This only sets the DataContext for the previewer in an IDE,
             to set the actual DataContext for runtime, set the DataContext property in code (look at App.axaml.cs) --&gt;</span>
        <span class="nt">&lt;viewModels:SnowflakeGameViewModel</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Design.DataContext&gt;</span>

    <span class="nt">&lt;Panel&gt;</span>
        <span class="c">&lt;!-- Just some Background for a nicer UI --&gt;</span>
        <span class="nt">&lt;Panel.Background&gt;</span>
            ...
        <span class="nt">&lt;/Panel.Background&gt;</span>

        <span class="c">&lt;!-- This is our SnowFlakesControl. It can be used like any other Control. --&gt;</span>
        <span class="nt">&lt;controls:SnowflakesControl</span> <span class="na">HorizontalAlignment=</span><span class="s">"Stretch"</span>
                                    <span class="na">VerticalAlignment=</span><span class="s">"Stretch"</span>
                                    <span class="na">IsRunning=</span><span class="s">"{Binding IsGameRunning}"</span>
                                    <span class="na">Snowflakes=</span><span class="s">"{Binding Snowflakes}"</span>
                                    <span class="na">Score=</span><span class="s">"{Binding Score}"</span> <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- Add a Progressbar to indicate the left time  here --&gt;</span>
        <span class="nt">&lt;ProgressBar</span> <span class="err">...</span> <span class="nt">/&gt;</span>

        <span class="c">&lt;!-- Add a Button the start command here --&gt;</span>
        <span class="nt">&lt;Button</span> <span class="err">...</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/Panel&gt;</span>
<span class="nt">&lt;/UserControl&gt;</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
In <code>App.axaml</code> set <code>RequestedThemeVariant</code> to <code>"Dark"</code> for a better visibility of the white snowflakes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>This is how the control will look like now (notice how the snowflakes disappear):</p>
</div>
<div class="paragraph">
<div class="title">First run output</div>
<p><span class="image"><img src="_docs/First_run.png" alt="First run"></span></p>
</div>
<div class="paragraph">
<p>Here is the final class <a href="Views/MainView.axaml">Views/MainView.axaml</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_1_implement_a_custom_draw_operation">Bonus 1: Implement a custom draw operation</h3>
<div class="paragraph">
<p>If the provided render operations are not enough, you can create a new class which implements <code>ICustomDrawOperation</code>. In this sample we want to display the user score with a nice glow effect using the <a href="https://learn.microsoft.com/en-us/dotnet/api/skiasharp?view=skiasharp-2.88">[<code>SkiaSharp-API</code>]</a>.</p>
</div>
<div class="paragraph">
<p>The interface requires the following members to be implemented:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 6. <code>ICustomDrawOperation</code>-members</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Equals</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">We can just return false here as we don&#8217;t want to reuse the class. Might be a good idea for a real-world App.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dispose</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Use this in case you need to dispose or clean up anything.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HitTest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">bool</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hit test the geometry in this node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Render</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">void</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This method will provide a <code>ImmediateDrawingContext</code> which gives you many low-level options to render.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bounds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Gets the bounds of the visible content in the node in global coordinates.</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>In addition to the interface members we will add one more property:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 7. Properties of ScoreRenderer</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Type</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private readonly property which holds the text to render</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Let&#8217;s see how the <code>Render</code>-method looks like:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="k">void</span> <span class="nf">Render</span><span class="p">(</span><span class="n">ImmediateDrawingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Try to get the skia-feature.</span>
    <span class="kt">var</span> <span class="n">leaseFeature</span> <span class="p">=</span> <span class="n">context</span><span class="p">.</span><span class="n">TryGetFeature</span><span class="p">&lt;</span><span class="n">ISkiaSharpApiLeaseFeature</span><span class="p">&gt;();</span>

    <span class="c1">// In case we didn't find it, render the text with a fallback.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">leaseFeature</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">glyphs</span> <span class="p">=</span> <span class="n">Text</span><span class="p">.</span><span class="nf">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">Typeface</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">GlyphTypeface</span><span class="p">.</span><span class="nf">GetGlyph</span><span class="p">(</span><span class="n">c</span><span class="p">)).</span><span class="nf">ToArray</span><span class="p">();</span>

        <span class="kt">var</span> <span class="n">glyphRun</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">GlyphRun</span><span class="p">(</span><span class="n">Typeface</span><span class="p">.</span><span class="n">Default</span><span class="p">.</span><span class="n">GlyphTypeface</span><span class="p">,</span>
            <span class="m">20</span><span class="p">,</span>
            <span class="n">Text</span><span class="p">.</span><span class="nf">AsMemory</span><span class="p">(),</span>
            <span class="n">glyphs</span><span class="p">,</span>
            <span class="n">Bounds</span><span class="p">.</span><span class="n">TopRight</span> <span class="p">-</span> <span class="k">new</span> <span class="nf">Point</span><span class="p">(</span><span class="m">50</span><span class="p">,</span> <span class="m">50</span><span class="p">));</span>

        <span class="n">context</span><span class="p">.</span><span class="nf">DrawGlyphRun</span><span class="p">(</span><span class="n">Brushes</span><span class="p">.</span><span class="n">Goldenrod</span><span class="p">,</span> <span class="n">glyphRun</span><span class="p">.</span><span class="nf">TryCreateImmutableGlyphRunReference</span><span class="p">()!);</span>
    <span class="p">}</span>
    <span class="c1">// Otherwise use SkiaSharp to render the text and apply some glow-effect.</span>
    <span class="c1">// Find the SkiaSharp-API here: https://learn.microsoft.com/en-us/dotnet/api/skiasharp?view=skiasharp-2.88</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">using</span> <span class="nn">var</span> <span class="n">lease</span> <span class="p">=</span> <span class="n">leaseFeature</span><span class="p">.</span><span class="nf">Lease</span><span class="p">();</span>
        <span class="kt">var</span> <span class="n">canvas</span> <span class="p">=</span> <span class="n">lease</span><span class="p">.</span><span class="n">SkCanvas</span><span class="p">;</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">Save</span><span class="p">();</span>

        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">paint</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">SKPaint</span><span class="p">())</span>
        <span class="p">{</span>
            <span class="n">paint</span><span class="p">.</span><span class="n">Shader</span> <span class="p">=</span> <span class="n">SKShader</span><span class="p">.</span><span class="nf">CreateColor</span><span class="p">(</span><span class="n">SKColors</span><span class="p">.</span><span class="n">Goldenrod</span><span class="p">);</span>
            <span class="n">paint</span><span class="p">.</span><span class="n">TextSize</span> <span class="p">=</span> <span class="m">30</span><span class="p">;</span>
            <span class="n">paint</span><span class="p">.</span><span class="n">TextAlign</span> <span class="p">=</span> <span class="n">SKTextAlign</span><span class="p">.</span><span class="n">Right</span><span class="p">;</span>

            <span class="kt">var</span> <span class="n">origin</span> <span class="p">=</span> <span class="n">Bounds</span><span class="p">.</span><span class="n">TopRight</span><span class="p">.</span><span class="nf">ToSKPoint</span><span class="p">();</span>
            <span class="n">origin</span><span class="p">.</span><span class="nf">Offset</span><span class="p">(-</span><span class="m">25</span><span class="p">,</span> <span class="p">+</span><span class="m">50</span><span class="p">);</span>

            <span class="n">paint</span><span class="p">.</span><span class="n">ImageFilter</span> <span class="p">=</span> <span class="n">SKImageFilter</span><span class="p">.</span><span class="nf">CreateDropShadow</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="m">10</span><span class="p">,</span> <span class="n">SKColors</span><span class="p">.</span><span class="n">White</span><span class="p">);</span>
            <span class="n">canvas</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="n">Text</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">paint</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">canvas</span><span class="p">.</span><span class="nf">Restore</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
SkiaSharp may be not always available. In this case it is highly recommended to provide a fallback.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You may see a warning about using an unstable API. This is okay to ignore, however you may need to adjust your code when you update to a newer Avalonia version.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To consume the custom draw operation, add the following line into <code>SnowflakesControl.OnRender</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Render</span><span class="p">(</span><span class="n">DrawingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// [...]</span>

    <span class="n">context</span><span class="p">.</span><span class="nf">Custom</span><span class="p">(</span><span class="k">new</span> <span class="nf">ScoreRenderer</span><span class="p">(</span><span class="n">Bounds</span><span class="p">,</span> <span class="s">$"Your score: </span><span class="p">{</span><span class="n">Score</span><span class="p">:</span><span class="n">N0</span><span class="p">}</span><span class="s">"</span><span class="p">));</span>

    <span class="c1">// [...]</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you now run the sample again, you can see the following outcome:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_docs/Second_run.png" alt="Second run">
</div>
<div class="title">Figure 1. Second run output</div>
</div>
<div class="paragraph">
<p>Here is the final class <a href="Controls/ScoreRenderer.cs">Controls/ScoreRenderer.cs</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_bonus_2_adding_some_beauty_to_the_game">Bonus 2: Adding some beauty to the game</h3>
<div class="paragraph">
<p>White snowflakes on a black screen may be boring for some users. In addition, the user can&#8217;t really see how much score each caught snowflake has gained. Let&#8217;s improve this.</p>
</div>
<div class="paragraph">
<p>In <code>MainView</code> we add a Background to the root <code>Panel</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="xml"><span class="nt">&lt;Panel.Background&gt;</span>
    <span class="nt">&lt;LinearGradientBrush</span> <span class="na">StartPoint=</span><span class="s">"0,0"</span> <span class="na">EndPoint=</span><span class="s">"0%,100%"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;GradientStop</span> <span class="na">Offset=</span><span class="s">"0"</span>   <span class="na">Color=</span><span class="s">"DarkBlue"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;GradientStop</span> <span class="na">Offset=</span><span class="s">".85"</span> <span class="na">Color=</span><span class="s">"LightSkyBlue"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;GradientStop</span> <span class="na">Offset=</span><span class="s">".85"</span> <span class="na">Color=</span><span class="s">"LimeGreen"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;GradientStop</span> <span class="na">Offset=</span><span class="s">"1"</span>   <span class="na">Color=</span><span class="s">"DarkGreen"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/LinearGradientBrush&gt;</span>
<span class="nt">&lt;/Panel.Background&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Moreover, we want to render some score hints for each hit snowflake. Similar to our <code>Snowflake</code>-class we will add the internal class <code>ScoreHint</code> which has the following properties:</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
This class can be internal as it is only meant to be consumed by the control itself.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We won&#8217;t go into too much detail here as the concept is very close to the already discussed <code>Snowflake</code>-class. Only noticeable difference is that it has a reference to an <code>ICollection&lt;ScoreHint&gt;</code> in order to remove itself after the display time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">internal</span> <span class="k">void</span> <span class="nf">Update</span><span class="p">(</span><span class="kt">double</span> <span class="n">elapsedMilliseconds</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Increment total elapsed time</span>
    <span class="n">_elapsedMillisecondsTotal</span> <span class="p">+=</span> <span class="n">elapsedMilliseconds</span><span class="p">;</span>

    <span class="c1">// remove this item from the collection if it was there for 1 second (1000 ms)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_elapsedMillisecondsTotal</span> <span class="p">&gt;=</span> <span class="m">1000</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_scoreHintsCollection</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// after 500 ms we wipe out the opacity and move the text upwards</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">_elapsedMillisecondsTotal</span> <span class="p">&gt;</span> <span class="m">500</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">var</span> <span class="n">percentage</span> <span class="p">=</span> <span class="p">(</span><span class="n">_elapsedMillisecondsTotal</span> <span class="p">-</span> <span class="m">500</span><span class="p">)</span> <span class="p">/</span> <span class="m">500</span><span class="p">;</span>
        <span class="n">Opacity</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="nf">Max</span><span class="p">(</span><span class="m">1.0</span> <span class="p">-</span> <span class="n">percentage</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span> <span class="c1">// Negative opacity doesn't work, so make sure it is always positive.</span>
        <span class="n">Y</span> <span class="p">-=</span> <span class="p">(</span><span class="m">0.01</span> <span class="p">*</span> <span class="n">percentage</span><span class="p">);</span> <span class="c1">// move slightly up.</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Here is the final class: <a href="Models/ScoreHint.cs">Models/ScoreHint.cs</a></p>
</div>
<div class="paragraph">
<p>We display the score hint in the <code>SnowflakeControl.OnRender</code>-method as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="csharp"><span class="k">public</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Render</span><span class="p">(</span><span class="n">DrawingContext</span> <span class="n">context</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">scoreHint</span> <span class="k">in</span> <span class="n">_scoreHintsCollection</span><span class="p">.</span><span class="nf">ToArray</span><span class="p">())</span>
    <span class="p">{</span>
        <span class="c1">// If the game is running, move each flake to it's updated position</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">IsRunning</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">scoreHint</span><span class="p">.</span><span class="nf">Update</span><span class="p">(</span><span class="n">elapsedMilliseconds</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// Use a formatted text to render the score hint.</span>
        <span class="kt">var</span> <span class="n">formattedText</span> <span class="p">=</span>
            <span class="k">new</span> <span class="nf">FormattedText</span><span class="p">(</span>
                <span class="n">scoreHint</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(),</span>
                <span class="n">CultureInfo</span><span class="p">.</span><span class="n">InvariantCulture</span><span class="p">,</span>
                <span class="n">FlowDirection</span><span class="p">.</span><span class="n">LeftToRight</span><span class="p">,</span>
                <span class="n">Typeface</span><span class="p">.</span><span class="n">Default</span><span class="p">,</span>
                <span class="m">20</span><span class="p">,</span>
                <span class="k">new</span> <span class="nf">SolidColorBrush</span><span class="p">(</span><span class="n">Colors</span><span class="p">.</span><span class="n">Yellow</span><span class="p">,</span> <span class="n">scoreHint</span><span class="p">.</span><span class="n">Opacity</span><span class="p">));</span>

        <span class="n">context</span><span class="p">.</span><span class="nf">DrawText</span><span class="p">(</span><span class="n">formattedText</span><span class="p">,</span> <span class="n">scoreHint</span><span class="p">.</span><span class="nf">GetTopLeftForViewport</span><span class="p">(</span><span class="n">Bounds</span><span class="p">,</span> <span class="k">new</span> <span class="nf">Size</span><span class="p">(</span><span class="n">formattedText</span><span class="p">.</span><span class="n">Width</span><span class="p">,</span> <span class="n">formattedText</span><span class="p">.</span><span class="n">Height</span><span class="p">)));</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_see_it_in_action">See it in action</h3>
<div class="paragraph">
<p>Hit [Run] in your IDE and enjoy your personal winter game.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_docs/final_run.png" alt="final run">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_related">Related</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="../../../../README.html#_drawing_samples">Samples.DrawingSamples</a></p>
</li>
<li>
<p><a href="https://github.com/AvaloniaUI/Avalonia/tree/master/samples/RenderDemo">Avalonia.RenderDemo</a></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-12-25 12:47:29 UTC
</div>
</div>
</body>
</html>